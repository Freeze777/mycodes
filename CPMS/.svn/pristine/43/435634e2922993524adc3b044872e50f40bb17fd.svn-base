package centurylink.cpms;






import java.util.Map;

import org.apache.struts2.interceptor.SessionAware;

import com.opensymphony.xwork2.ActionSupport;
import com.opensymphony.xwork2.ModelDriven;
import com.sun.net.httpserver.Authenticator.Failure;

public class CpmsAction extends ActionSupport
implements SessionAware,ModelDriven {
	private User user = new User();	
	private String message;
	private static ServiceInterface serviceObj =new ServiceLayer();
	private Map<String,Object> sessionMap;
	
	@Override
	public void setSession(Map sessionMap) {
		// TODO Auto-generated method stub
		System.out.println("in setsession");
		this.sessionMap=sessionMap; 
	}
	
	public String getMessage() {
		return message;
	}
	public void setMessage(String message) {
		this.message = message;
	}
	public User getUser() {
		return user;
	}
	public void setUser(User user) {
		this.user = user;
	}

	public String homepage()
	{
		
		return "login";
		
		
	}
	
	
	
	public String registerUser() throws Exception {
		
		
		System.out.println("registerUser-Cpms action");
		
		String bls=serviceObj.registerUser(user);
		if (bls.equals("ok")) {
			sessionMap.put("user",user);
			sessionMap.put("username","Welcome  "+user.getCuid());
			return SUCCESS;
		}
		else if (bls.equals("iat")) {
			setMessage("The CUID is already registered");
			return "iat";

		}	else {
			setMessage("Registeration Failed. PLease Retry");
			return ERROR;
		}
			
		// TODO Auto-generated method stub

	}

	public String validateLogin() throws Exception {
		
		System.out.println(" validatelogin function");


		
        
		String  userName= serviceObj.loginUser(user);
		if (userName!=null)
		{ user.setPassword(((Integer)user.getPassword().hashCode()).toString());
			sessionMap.put("user",user);
			
			sessionMap.put("username","Welcome  "+userName );
			//setMessage("Welcome  "+userName);
			return SUCCESS;
		}
		else
			setMessage("Invalid CUID/Password");
			return ERROR;




	}
	public String signup() throws Exception {
			
		return SUCCESS;

	}
	
	
	public String logoutUser()
	{System.out.println("logg out");
		sessionMap.remove("user");	
		sessionMap.remove("username");
	
		System.out.println(sessionMap.get("user"));
		setMessage("Logged out successfully");
		return SUCCESS;
		
	}

	@Override

	public Object getModel() {
		// TODO Auto-generated method stub
		return user;
	}





}
